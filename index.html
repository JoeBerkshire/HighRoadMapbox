<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>High Road Map</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>
<style>
    #menu {
        background: #fff;
        position: absolute;
        z-index: 1;
        top: 20px;
        left: 20px;
        border-radius: 3px;
        width: 120px;
        border: 1px solid rgba(0,0,0,0.4);
        font-family: 'Open Sans', sans-serif;
    }

    #menu a {
        font-size: 13px;
        color: #404040;
        display: block;
        margin: 0;
        padding: 0;
        padding: 10px;
        text-decoration: none;
        border-bottom: 1px solid rgba(0,0,0,0.25);
        text-align: center;
    }

    #menu a:last-child {
        border: none;
    }

    #menu a:hover {
        background-color: #f8f8f8;
        color: #404040;
    }

    #menu a.active {
        background-color: #3887be;
        color: #ffffff;
    }

    #menu a.active:hover {
        background: #3074a4;
    }
    .mapboxgl-popup {
        max-width: 400px;
        font-family: 'Open Sans',sans-serif;
    }
</style>
<nav id='menu'></nav>
<div id='map'></div>
<!--<div id='base'>
     this is all related to the broken basemap toggle below 
    <input id='joeberkshire/cjtsmkqyy0tnk1fp794b3svet' type='radio' name ='rtoggle' value = 'default' checked='checked'>
    <label for='default'>default</label>
    <input id='streets-v11' type='radio' name='rtoggle' value='streets'>
    <label for='streets'>streets</label>
    <input id='light-v10' type='radio' name='rtoggle' value='light'>
    <label for='light'>light</label>
    <input id='dark-v10' type='radio' name='rtoggle' value='dark'>
    <label for='dark'>dark</label>
    <input id='outdoors-v11' type='radio' name='rtoggle' value='outdoors'>
    <label for='outdoors'>outdoors</label>
    <input id='satellite-v9' type='radio' name='rtoggle' value='satellite'>
    <label for='satellite'>satellite</label> 
</div>-->
<script>
mapboxgl.accessToken = 'pk.eyJ1Ijoiam9lYmVya3NoaXJlIiwiYSI6ImNqdHI5cDQ1NTBleGE0MHBpOGU0cWJrN24ifQ.8JjEpApr73tZ0UeS62MwIw';
const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/joeberkshire/cjtsmkqyy0tnk1fp794b3svet', // '.../user/basemapid' click "share" while using studio
    center: [-72.915,42.418],
    zoom: 9.2
    });
   
/* the following is a broken attempt at creating a menu where one can switch basemaps 
var layerList = document.getElementById('base');
var inputs = layerList.getElementsByTagName('input');
 
function switchLayer(layer) {
var layerId = layer.target.id;
map.setStyle('mapbox://styles/mapbox/' + layerId);
}
 
for (var i = 0; i < inputs.length; i++) {
inputs[i].onclick = switchLayer;
}*/

// following is layer loading 
map.on('load', function () {
    map.addSource('trails', {
        type: 'vector',
        url: 'mapbox://joeberkshire.0x2a68l4' //find these pieces at studio.mapbox.com/tilesets
    });
    map.addSource('openspace', {
        type: 'vector',
        url: 'mapbox://joeberkshire.7vixamhx' //find these pieces at studio.mapbox.com/tilesets
    });
    map.addLayer({
        'id': 'open space',
        'type': 'fill',
        'source': 'openspace',
        'source-layer': 'os_brk_18-90omqh', 
        'layout': {
        'visibility': 'visible',
        },
        'paint': {
            'fill-color': "hsla(108, 28%, 63%, 0.66)",
        },
    })
    map.addSource('bnrc', {
        type: 'vector',
        url: 'mapbox://joeberkshire.56tw17tz' //find these pieces at studio.mapbox.com/tilesets
    });
    map.addLayer({
        'id': 'bnrc properties',
        'type': 'fill',
        'source': 'bnrc',
        'source-layer': 'bnrc-77v0yp', 
        'layout': {
        'visibility': 'visible',
        },
        'paint': {
            'fill-color': "hsla(196, 42%, 35%, 0.8)",
        },
    })
    map.addLayer({
        'id': 'trails',
        'type': 'line',
        'source': 'trails',
        'source-layer': 'trl-6wini7', 
        'layout': {
        'visibility': 'visible',
        'line-cap': 'round',
        'line-join':'round',
        },
        'paint': {
            'line-width': 4,
            'line-color': [
              "match",
              ["get", "PHASE"],
              ["1"],
              "#201870",
              ["2"],
              "hsl(300, 44%, 28%)",
              ["3"],
              "#d07848",
              ["4"],
              "#f8a848",
              ["5"],
              "hsla(0, 0%, 0%, 0)",
              "#000000"
            ]
        },
    })
     map.addSource('roads', {
        type: 'vector',
        url: 'mapbox://joeberkshire.b3rgsj9t' //find these pieces at studio.mapbox.com/tilesets
    });
    map.addLayer({
        'id': 'roads',
        'type': 'line',
        'source': 'roads',
        'source-layer': 'rds-cqj627', 
        'layout': {
        'visibility': 'visible',
        'line-cap': 'round',
        'line-join':'round',
        },
        'paint': {
            'line-width': 4,
            'line-dasharray': [
                1,2
            ],
            'line-color': [
              "match",
              ["get", "phase"],
              [1],
              "#201870",
              [2],
              "hsl(300, 44%, 28%)",
              [3],
              "#d07848",
              [4],
              "#f8a848",
              [5],
              "hsla(0, 0%, 0%, 0)",
              "#000000"
            ]
        },
    })
    });
 
    
// if new layers are added, changed, renamed, etc. change them here to update the toggle piece 
 var toggleableLayerIds = [ 'trails','roads','open space', 'bnrc properties' ];
    

 // following is the layer toggle script
for (var i = 0; i < toggleableLayerIds.length; i++) {
    var id = toggleableLayerIds[i];

    var link = document.createElement('a');
    link.href = '#';
    link.className = 'active';
    link.textContent = id;

    link.onclick = function (e) {
        var clickedLayer = this.textContent;
        e.preventDefault();
        e.stopPropagation();

        var visibility = map.getLayoutProperty(clickedLayer, 'visibility');

        if (visibility === 'visible') {
            map.setLayoutProperty(clickedLayer, 'visibility', 'none');
            this.className = '';
        } else {
            this.className = 'active';
            map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
        }
    };

    var layers = document.getElementById('menu');
    layers.appendChild(link);
    }
    
// trails popup showing name and other routes
map.on('click', 'trails', function (e) {
    new mapboxgl.Popup()
        .setLngLat(e.lngLat)
        .setHTML(
         e.features[0].properties.NAME)
        .addTo(map);
    });
 
// Change the cursor to a pointer when the mouse is over the places layer.
    map.on('mouseenter', 'trails', function () {
        map.getCanvas().style.cursor = 'pointer';
    });
 
// Change it back to a pointer when it leaves.
    map.on('mouseleave', 'trails', function () {
        map.getCanvas().style.cursor = '';
    });
    
   // roads popup showing name? Not sure if there's a way to merge this and previous popup function 
map.on('click', 'roads', function (e) {
    new mapboxgl.Popup()
        .setLngLat(e.lngLat)
        .setHTML(e.features[0].properties.St_Name)
        .addTo(map);
    });
 
// Change the cursor to a pointer when the mouse is over the places layer.
    map.on('mouseenter', 'roads', function () {
        map.getCanvas().style.cursor = 'pointer';
    });
 
// Change it back to a pointer when it leaves.
    map.on('mouseleave', 'roads', function () {
        map.getCanvas().style.cursor = '';
    });
</script>

</body>
</html>
